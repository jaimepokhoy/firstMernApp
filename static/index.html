<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Bug Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.3/react.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.3/react-dom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  </head>

  <body>
    <div id="main">

    </div>

    <div id="example">
    </div>

	<!-- <script src="/App.js" type="text/babel"></script> -->
  <script type="text/babel">
  var BugFilter = React.createClass({
render: function() {
return (
  <div>A way to filter the list of bugs would come here.</div>
)
}
});

  var BugRow = React.createClass({
    render: function() {
      console.log("rendering bugRow:", this.props.bug);
      return (
      <tr>
        <td>{this.props.bug.id}</td>
        <td>{this.props.bug.status}</td>
        <td>{this.props.bug.priority}</td>
        <td>{this.props.bug.owner}</td>
        <td>{this.props.bug.title}</td>
      </tr>
    )
    }
  });

var BugTable = React.createClass({
render: function() {
  console.log("rendering bug table, num items:", this.props.bugs.length);
  var bugRows = this.props.bugs.map(function(bug) {
    return <BugRow key={bug.id} bug={bug} />
  });
return (
  <table>
    <thead>
      <tr>
        <th>Id</th>
        <th>Status</th>
        <th>Priority</th>
        <th>Owner</th>
        <th>Title</th>
      </tr>
    </thead>
    <tbody>
      {bugRows}
    </tbody>
  </table>
)
}
});

var BugAdd = React.createClass({
render: function() {
return (
  <div>
    <form name="bugAdd">
      <input type="text" name="owner" placeholder="Owner" />
      <input type="text" name="title" placeholder="Title" />
      <button onClick={this.handleSubmit}>Add Bug</button>
    </form>
  </div>
)
},

handleSubmit: function(e) {
  e.preventDefault();
  var form = document.forms.bugAdd;
  this.props.addBug({owner: form.owner.value, title: form.title.value, status: 'New', priority: 'P1'});
  form.owner.value = ""; form.title.value = "";
}
});

var bugData = [
  {id: 1, priority: 'P1', status: 'Open', owner: 'Ravan', title:'App crashes on open'},
  {id: 2, priority: 'P2', status: 'New', owner: 'Eddie', title:'Misaligned border on panel'}
];

var BugList = React.createClass({
getInitialState: function() {
  return {bugs: bugData};
},
render: function() {
return (
  <div>
    <h1>Bug Tracker</h1>
    <BugFilter />
    <hr />
    <BugTable bugs={this.state.bugs}/>
    <hr />
    <BugAdd addBug={this.addBug}/>
  </div>
)
},


addBug: function(bug) {
  console.log("adding bug:", bug);

  var bugsModified = this.state.bugs.slice();
  bug.id = this.state.bugs.length + 1;
  bugsModified.push(bug);
  this.setState({bugs: bugsModified});
}
});

ReactDOM.render(
<BugList />,
document.getElementById('main')
);
	</script>

  </body>
</html>
